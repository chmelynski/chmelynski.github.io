{"metadata":{"version":1,"view":"widgets"},"components":[{"type":"data","name":"items","visible":false,"data":[["2017-01-03","2:00pm","foo","item1"],["2017-01-03","2:00pm","bar","item2"],["2017-01-04","2:00pm","baz","item3"],["2017-01-05","2:00pm","foo","item4"]],"params":{"format":"headerList","display":"csv","form":"listOfObjects","headers":["date","time","class","text"],"afterChange":"Hyperdeck.Run('draw')"}},{"type":"css","name":"css1","visible":false,"text":"table {\n\tborder-collapse: collapse;\n}\n\nth {\n\tborder: 1px solid black;\n\ttext-align: center;\n\twidth: 10em;\n\theight: 1.5em\n}\n\ntd {\n\tborder: 1px solid black;\n\tvertical-align: top;\n\twidth: 10em;\n\theight: 10em;\n\tpadding: 0.3em;\n}\n\ntd.today {\n\tbackground-color: rgb(255,200,0);\n}\n\nspan.date {\n\tfont-weight: bold;\n}\n\nspan.foo { color: red; }\nspan.bar { color: green; }\nspan.baz { color: blue; }\n\n","display":"codemirror","mode":"default","runOnBlur":true,"runOnLoad":true},{"type":"js","name":"draw","visible":false,"text":"\nfunction DateToKey(date) { return date.toUTCString().substr(5, 11); } // Jul 31 2016\n\nvar startDate = '2017-01-01';\nvar endDate = '2017-07-01';\n\nvar items = Hyperdeck.Get('items');\n\nvar ticksPerDay = 86400000;\n\nvar startDateObj = new Date(startDate);\nvar endDateObj = new Date(endDate);\nvar days = ((endDateObj - startDateObj) / ticksPerDay) + 1;\nvar weeks = Math.ceil(days / 7);\n\n// create blank calendar\nvar calendar = {};\nvar date = new Date(startDate);\nfor (var i = 0; i < days; i++)\n{\n\tdate.setTime(date.getTime() + ticksPerDay);\n\tvar dateKey = DateToKey(date);\n\tcalendar[dateKey] = [];\n}\n\n// fill calendar with items\nitems.forEach(function(item) { calendar[DateToKey(new Date(item.date))].push(item); });\n\n// build calendar\nvar date = new Date(startDate);\nvar ls = [];\nls.push('<table>');\nls.push('<tr><th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th></tr>');\nfor (var i = 0; i < weeks; i++)\n{\n\tls.push('<tr>');\n\t\n\tfor (var j = 0; j < 7; j++)\n\t{\n\t\tls.push('<td>');\n\t\tvar dateKey = DateToKey(date);\n\t\tvar dateStr = dateKey.startsWith('01') ? dateKey.substr(0, 6) : dateKey.substr(0, 2);\n\t\tls.push('<span class=\"date\">'+dateStr+'</span>' + '<br />');\n\t\tvar items = calendar[dateKey];\n\t\t\n\t\tif (items)\n\t\t{\n\t\tvar contents = items.map(function(item) {\n\t\t\treturn '<span class=\"'+item.class+'\">'+item.text+'</span>';\n\t\t});\n\t\t\n\t\tls.push(contents.join('<br />'));\n\t\t}\n\t\t\n\t\tls.push('</td>');\n\t\tdate.setTime(date.getTime() + ticksPerDay);\n\t}\n\t\n\tls.push('</tr>');\n}\n\nls.push('</table>');\nreturn ls.join('');\n\n","display":"codemirror","mode":"htmlgen","runOnBlur":true,"runOnLoad":true}]}